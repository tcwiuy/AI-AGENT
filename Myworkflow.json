{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "url": "https://api.themoviedb.org/3/discover/movie",
        "authentication": "genericCredentialType",
        "genericAuthType": "queryAuth",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "language",
              "value": "vi-VN"
            },
            {
              "name": "region",
              "value": "VN"
            },
            {
              "name": "api_key",
              "value": "your_key_here"
            },
            {
              "name": "sort_by",
              "value": "vote_average.desc"
            },
            {
              "name": "with_genres",
              "value": "={{ $json.genre_ids }}"
            },
            {
              "name": "primary_release_date.gte",
              "value": "={{ $json.release_date_gte }}"
            },
            {
              "name": "primary_release_date.lte",
              "value": "={{ $json.release_date_lte }}"
            },
            {
              "name": "vote_count.gte",
              "value": "200"
            }
          ]
        },
        "options": {}
      },
      "id": "a44934ab-15b6-43f3-867e-8bc5e7fe1233",
      "name": "L·∫•y Phim TMDB",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        160,
        -160
      ]
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y 10 phim ƒë·∫ßu ti√™n\nconst movies = items[0].json.results.slice(0, 10);\n\nreturn movies.map(movie => {\n  // 1. T·ª± ƒë·ªông l·∫•y nƒÉm ph√°t h√†nh (n·∫øu c√≥)\n  let year = \"N/A\";\n  if (movie.release_date) {\n    year = movie.release_date.split('-')[0];\n  }\n\n  // 2. Tr·∫£ v·ªÅ d·ªØ li·ªáu s·∫°ch\n  return {\n    json: {\n      title: movie.title, // T√™n ti·∫øng Vi·ªát\n      original_title: movie.original_title, // T√™n g·ªëc (ƒë·ªÉ t√¨m ki·∫øm)\n      year: year, // NƒÉm (ƒë·ªÉ t√¨m ch√≠nh x√°c)\n      overview: movie.overview,\n      poster_path: \"https://image.tmdb.org/t/p/w500\" + movie.poster_path,\n      vote_average: movie.vote_average,\n      release_date: movie.release_date\n    }\n  }\n});"
      },
      "id": "d1604b59-983c-4bb5-b19b-61ecd5d32889",
      "name": "L·ªçc 3 Phim Hot",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        -32,
        64
      ]
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $('Telegram Trigger1').first().json.message.chat.id }}",
        "file": "={{ $('L·ªçc 3 Phim Hot').item.json.poster_path ? \"https://image.tmdb.org/t/p/w500\" + $('L·ªçc 3 Phim Hot').item.json.poster_path : \"\" }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üé¨ Xem Trailer",
                    "additionalFields": {
                      "url": "=https://www.youtube.com/results?search_query=Trailer+{{ $('L·ªçc 3 Phim Hot').item.json.original_title }}"
                    }
                  },
                  {
                    "text": "üîé T√¨m phim n√†y",
                    "additionalFields": {
                      "url": "=https://www.google.com/search?q=Xem+phim+{{ $('L·ªçc 3 Phim Hot').item.json.title }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "caption": "=<b>üé¨ {{ ($json.Title || $('L·ªçc 3 Phim Hot').item.json.title).toUpperCase() }}</b>\n<code>{{ $json.Title ? $('L·ªçc 3 Phim Hot').item.json.original_title : \"\" }}</code>\n\nüìÖ NƒÉm: <code>{{ $json.Year || $('L·ªçc 3 Phim Hot').item.json.year || \"N/A\" }}</code>\n‚è± Th·ªùi l∆∞·ª£ng: <code>{{ $json.Runtime || \"N/A\" }}</code>\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n{{\n(() => {\n    // 1. L·∫•y d·ªØ li·ªáu t·ª´ OMDb\n    const rtObj = $json.Ratings ? $json.Ratings.find(x => x.Source === \"Rotten Tomatoes\") : null;\n    const rt = rtObj ? rtObj.Value : \"N/A\";\n    const imdb = ($json.imdbRating && $json.imdbRating !== \"N/A\") ? $json.imdbRating + \"/10\" : \"N/A\";\n    \n    // 2. L·∫•y d·ªØ li·ªáu d·ª± ph√≤ng t·ª´ TMDB\n    const tmdb = $('L·ªçc 3 Phim Hot').item.json.vote_average ? $('L·ªçc 3 Phim Hot').item.json.vote_average.toFixed(1) + \"/10\" : \"Ch∆∞a c√≥\";\n\n    // 3. LOGIC QUY·∫æT ƒê·ªäNH HI·ªÇN TH·ªä\n    // N·∫øu c√≥ √≠t nh·∫•t 1 trong 2 ƒëi·ªÉm OMDb (RT ho·∫∑c IMDb) th√¨ hi·ªán form OMDb\n    if (rt !== \"N/A\" || imdb !== \"N/A\") {\n        return \"üçÖ <b>RT:</b> <code>\" + rt + \"</code>\\n\" +\n               \"‚≠êÔ∏è <b>IMDb:</b> <code>\" + imdb + \"</code>\";\n    } \n    // N·∫øu c·∫£ 2 ƒë·ªÅu N/A (t·ª©c l√† OMDb th·∫•t b·∫°i) -> Hi·ªán TMDB\n    else {\n        return \"üìà <b>TMDB:</b> <code>\" + tmdb + \"</code> (D·ªØ li·ªáu c·ªông ƒë·ªìng)\";\n    }\n})()\n}}\nüèÜ <b>Gi·∫£i th∆∞·ªüng:</b>\n<i>{{ $json.Awards && $json.Awards != \"N/A\" ? $json.Awards : \"Ch∆∞a c√≥ th√¥ng tin\" }}</i>\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìù <b>T√≥m t·∫Øt n·ªôi dung:</b>\n{{ ($('L·ªçc 3 Phim Hot').item.json.overview || \"ƒêang c·∫≠p nh·∫≠t...\").toString().slice(0, 350) }}...",
          "parse_mode": "HTML"
        }
      },
      "id": "d8463622-df3e-4e8d-938e-532b4af96bc5",
      "name": "G·ª≠i ·∫¢nh Poster",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        368,
        64
      ],
      "webhookId": "a98dd8e3-9a34-4fe6-973d-8d377f7852c3",
      "credentials": {
        "telegramApi": {
          "id": "8gj2NnaX1h5Pzsnt",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "id": "ae49ae00-7dea-405b-9e29-f3dd424d746f",
      "name": "Telegram Trigger1",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [
        -528,
        -160
      ],
      "webhookId": "my-telegram-bot",
      "credentials": {
        "telegramApi": {
          "id": "8gj2NnaX1h5Pzsnt",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Telegram Trigger1').first().json.message.text }}",
        "messages": {
          "messageValues": [
            {
              "message": "=B·∫°n l√† m·ªôt API th√¥ng minh gi√∫p t√¨m ki·∫øm phim. Nhi·ªám v·ª• c·ªßa b·∫°n l√† tr√≠ch xu·∫•t th√¥ng tin t·ª´ c√¢u n√≥i c·ªßa ng∆∞·ªùi d√πng th√†nh ƒë·ªãnh d·∫°ng JSON chu·∫©n.  1. INPUT (Ng∆∞·ªùi d√πng n√≥i): {{ $('Telegram Trigger1').first().json.message.text }}  2. B·∫¢NG M√É TH·ªÇ LO·∫†I (TMDB Genre ID): - H√†nh ƒë·ªông: 28 | Phi√™u l∆∞u: 12 | Ho·∫°t h√¨nh: 16 | H√†i: 35 | H√¨nh s·ª±: 80 - T√†i li·ªáu: 99 | Ch√≠nh k·ªãch (Drama): 18 | Gia ƒë√¨nh: 10751 | Gi·∫£ t∆∞·ªüng: 14 | L·ªãch s·ª≠: 36 - Kinh d·ªã: 27 | Nh·∫°c: 10402 | B√≠ ·∫©n: 9648 | L√£ng m·∫°n: 10749 - Khoa h·ªçc vi·ªÖn t∆∞·ªüng: 878 | Gay c·∫•n: 53 | Chi·∫øn tranh: 10752 | Mi·ªÅn t√¢y: 37  3. QUY T·∫ÆC X·ª¨ L√ù NG√ÄY: - N·∫øu t√¨m th·∫•y nƒÉm (v√≠ d·ª•: 2010), h√£y chuy·ªÉn th√†nh ƒë·ªãnh d·∫°ng ng√†y ƒë·∫ßy ƒë·ªß. - Start date m·∫∑c ƒë·ªãnh l√† ng√†y 01-01 (VD: 2010-01-01). - End date m·∫∑c ƒë·ªãnh l√† ng√†y 12-31 (VD: 2010-12-31). - N·∫øu kh√¥ng c√≥ nƒÉm, h√£y ƒë·ªÉ tr·ªëng ho·∫∑c d√πng kho·∫£ng m·∫∑c ƒë·ªãnh r·ªông (2000-2025).  4. Y√äU C·∫¶U OUTPUT (C·ª±c k·ª≥ quan tr·ªçng): - Ch·ªâ tr·∫£ v·ªÅ duy nh·∫•t chu·ªói JSON. KH√îNG c√≥ markdown (```json), KH√îNG gi·∫£i th√≠ch, KH√îNG ch√†o h·ªèi. - ƒê·ªãnh d·∫°ng JSON b·∫Øt bu·ªôc: {   \"genre_ids\": \"s·ªë ID (n·∫øu nhi·ªÅu th√¨ ngƒÉn c√°ch b·∫±ng d·∫•u ph·∫©y)\",   \"release_date_gte\": \"YYYY-MM-DD\",   \"release_date_lte\": \"YYYY-MM-DD\" }"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.9,
      "position": [
        -336,
        -160
      ],
      "id": "adae5978-3c39-43bc-a3bb-32952e82cb45",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -336,
        48
      ],
      "id": "e7f7a8cc-34c7-45bb-a073-bd0c2c2c58c2",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "STrakrLAv79G4527",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y k·∫øt qu·∫£ text t·ª´ AI\nconst aiText = $input.first().json.text;\n\n// X√≥a c√°c k√Ω t·ª± markdown th·ª´a (```json v√† ```)\nconst cleanJson = aiText.replace(/```json|```/g, '').trim();\n\n// Chuy·ªÉn t·ª´ chu·ªói Text sang JSON Object\ntry {\n  const parsedData = JSON.parse(cleanJson);\n  return { json: parsedData };\n} catch (error) {\n  // N·∫øu l·ªói, tr·∫£ v·ªÅ m·∫∑c ƒë·ªãnh l√† phim h√†nh ƒë·ªông m·ªõi nh·∫•t\n  return { json: { \n      genre_ids: \"28\", \n      release_date_gte: \"2024-01-01\", \n      release_date_lte: \"2025-12-31\" \n  }};\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        -160
      ],
      "id": "988aabee-ec27-42a8-a83f-2c713e27cb1a",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "url": "http://www.omdbapi.com/",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "your_key_here"
            },
            {
              "name": "t",
              "value": "={{ $json.original_title }}"
            },
            {
              "name": "y",
              "value": "={{ $json.year }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        176,
        64
      ],
      "id": "a25e0cfd-4b03-4774-bc4b-61d624f52c2a",
      "name": "HTTP Request",
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "L·∫•y Phim TMDB": {
      "main": [
        [
          {
            "node": "L·ªçc 3 Phim Hot",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "L·ªçc 3 Phim Hot": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Trigger1": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "L·∫•y Phim TMDB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "G·ª≠i ·∫¢nh Poster",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "888b44ed-25fd-43ba-a2ab-269e0bd7c601",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c5de79b2c0aa4375f7c26057e2a927c8ad68091711c4a615385d1878a6a3ec3b"
  },
  "id": "n4we-udCIILRZPtb1Pog_",
  "tags": []
}